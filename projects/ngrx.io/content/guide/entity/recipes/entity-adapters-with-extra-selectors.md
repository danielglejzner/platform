# Using entity adapters with extra selectors of a feature

This example demonstrates a User state management using NgRx Store with `Entity Adapters` and `Extra Selectors` for a feature.

Usage:

Start by defining the state for the `User` feature.

<code-example header="user.reducer.ts">
import { EntityState, createEntityAdapter } from '@ngrx/entity';

interface User {
  id: string;
  name: string;
}

export interface UserState extends EntityState<User> {
  selectedUserId: string | null;
}

export const userAdapter = createEntityAdapter<User>();

export const initialState: UserState = userAdapter.getInitialState({
  selectedUserId: null,
});
</code-example>

Then, we define the `User` actions: `addUser` and `selectUser`.

<code-example header="user.actions.ts">
import { createAction, props } from '@ngrx/store';

export const UserActions = {
  addUser: createAction('[User] Add User', props<{ user: User }>()),
  selectUser: createAction('[User] Select User', props<{ userId: string }>()),
};
</code-example>

Then use the `createReducer` function from NgRx to create a reducer for the `User` feature.

<code-example header="user.reducer.ts">
import { createReducer, on } from '@ngrx/store';
import { UserActions } from './user.actions';

export const userReducer = createReducer(
  initialState,
  on(UserActions.addUser, (state, { user }) => userAdapter.addOne(user, state)),
  on(UserActions.selectUser, (state, { userId }) => ({ ...state, selectedUserId: userId }))
);
</code-example>

Then create the `User` feature using the `createFeature` function. This will generate all basic selectors automatically, and we can specify extra selectors using the `extraSelectors` option.

<code-example header="user.feature.ts">

import { createSelector, createFeature } from '@ngrx/store';

export const userFeature = createFeature({
  name: 'user',
  reducer: userReducer,
  extraSelectors: ({ selectUserState, selectEntities, selectSelectedUserId }) => ({
    ...userAdapter.getSelectors(selectUserState),
    selectIsUserSelected: createSelector(
      selectSelectedUserId,
      (selectedId) => selectedId !== null
    ),
    selectSelectedUser: createSelector(
      selectSelectedUserId,
      selectEntities,
      (selectedId, entities) => selectedId ? entities[selectedId] : null
    ),
  }),
});
</code-example>

In the component, we `inject` the `Store` service from NgRx and select the data we need from the state using the selectors generated by the `createFeature` function.

<code-example header="userList.component.ts">
export class UserListComponent{
	readonly store = inject(Store);
	readonly isUserSelected$ = this.store.select(userFeature.selectIsUserSelected);
  readonly selectedUser$ = this.store.select(userFeature.selectSelectedUser);
}
</code-example>

